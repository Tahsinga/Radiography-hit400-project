{% extends 'base.html' %}

{% block title %}Book Appointment - MIC Radiology{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">Book an Appointment</h4>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="{{ form.scan_type.id_for_label }}" class="form-label">
                                Scan Type <span class="text-danger">*</span>
                            </label>
                            {{ form.scan_type }}
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.appointment_date.id_for_label }}" class="form-label">
                                    Date <span class="text-danger">*</span>
                                </label>
                                {{ form.appointment_date }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.appointment_time.id_for_label }}" class="form-label">
                                    Time <span class="text-danger">*</span>
                                </label>
                                {{ form.appointment_time }}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.referral_document.id_for_label }}" class="form-label">
                                Referral Document
                            </label>
                            {{ form.referral_document }}
                            <small class="form-text text-muted">Upload your referral letter or authorization document (PDF, DOC, JPG, PNG)</small>
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.clinical_notes.id_for_label }}" class="form-label">
                                Clinical Notes
                            </label>
                            {{ form.clinical_notes }}
                            <small class="form-text text-muted">Any relevant medical history or concerns</small>
                        </div>

                        <!-- Payment Summary -->
                        <div class="card bg-light mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">Payment Summary</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Service Charge:</strong> <span id="serviceCharge">-</span></p>
                                        <p><strong>Medical Aid Coverage:</strong> <span id="medicalAidCoverage">-</span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Your Co-Payment:</strong> <span id="coPayment" class="text-primary fs-5"><strong>-</strong></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="termsCheck" required>
                                <label class="form-check-label" for="termsCheck">
                                    I agree to the terms and conditions and understand the payment details
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Book Appointment</button>
                        <a href="{% url 'patient_dashboard' %}" class="btn btn-secondary">Cancel</a>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Information</h6>
                </div>
                <div class="card-body">
                    <h6>Before Your Appointment</h6>
                    <ul class="small">
                        <li>Arrive 15 minutes early</li>
                        <li>Bring your ID and medical aid card</li>
                        <li>Bring any relevant medical documents</li>
                        <li>Remove metal objects</li>
                    </ul>

                    <h6 class="mt-3">Payment</h6>
                    <p class="small">Payment can be made at the facility using cash, card, or mobile payment methods. Medical aid coverage will be applied automatically.</p>

                    <h6 class="mt-3">Cancellation Policy</h6>
                    <p class="small">Appointments can be cancelled up to 24 hours before the scheduled time.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('scanType').addEventListener('change', function() {
    updatePaymentSummary();
});

function updatePaymentSummary() {
    // In production, fetch from server
    const serviceCharge = Math.random() * 1000;
    const coverage = serviceCharge * 0.8;
    const coPayment = serviceCharge - coverage;

    document.getElementById('serviceCharge').textContent = 'R' + serviceCharge.toFixed(2);
    document.getElementById('medicalAidCoverage').textContent = 'R' + coverage.toFixed(2);
    document.getElementById('coPayment').textContent = 'R' + coPayment.toFixed(2);
}

updatePaymentSummary();
</script>
{% endblock %}
